package de.janbellenberg.smarthome.core;

import java.util.Properties;
import java.util.logging.Logger;

import javax.annotation.PostConstruct;
import javax.ejb.Singleton;
import javax.ejb.Startup;

import com.fasterxml.jackson.databind.JsonNode;

@Singleton
@Startup
public class Initialization {
  /**
   * startup message and initial checks
   */
  @PostConstruct()
  public void init() {
    // Startup message

    Logger logger = Logger.getLogger("de.janbellenberg.smarthome");

    logger.info("                                        .,,**///((((///***,.                                        ");
    logger.info("                                .*///(((((((((((((((((((((((((((//*,.                               ");
    logger.info("                          .,//(((((((((((((((((((((((((((((((((((((((((/*,                          ");
    logger.info("                      .*/((((((((((((((((((((((((((((((((((((((((((((((((((//,                      ");
    logger.info("                   ,//((((((((((((((((((((((((((((((((((((((((((((((((((((((((((*.                  ");
    logger.info("                ,/((((((((((((((((((((((((((((((((/(((((((((((((((((((((((((((((((/*.               ");
    logger.info("             .*/(((((((((((((((,         *(((((*    ./(((((((((((((((((((((((((((((((/,             ");
    logger.info("           ,/((((((((((((((((((, ./(((*  *((*    */,   ./((((((((((((((((((((((((((((((/*           ");
    logger.info("         ./((((((((((((((((((((, ./(((//(*.   */(((((/.   ./(((((((((((((((((((((((((((((/*.        ");
    logger.info("       .*((((((((((((((((((((((, ./(((*.   ,((((((((((((/,   ,/((((((((((((((((((((((((((((/,       ");
    logger.info("      */(((((((((((((((((((((((,.*(/.   ,/(((((((((((((((((/.   ,/(((((((((((((((((((((((((((/.     ");
    logger.info("     */(((((((((((((((((((((((((/.   ,/(((((((((((((((((((((((*.   ,/(((((((((((((((((((((((((/,    ");
    logger.info("   ./((((((((((((((((((((((((/.   ./(((((((((((((((((((((((((((((*.   ,/(((((((((((((((((((((((/,   ");
    logger.info("  .*((((((((((((((((((((((/,   .*((///////////////////////////////(/*    ,((((((((((((((((((((((/,  ");
    logger.info("  *((((((((((((((((((((/,                                                  ./((((((((((((((((((((/, ");
    logger.info(" */((((((((((((((((((((/,  ./((((((((((((((((((((((((((((((((((((((((((/,  ./(((((((((((((((((((((/.");
    logger.info("./(((((((((((((((((((((/.  ,/((((((((((((((((((((((((((((((((((((((((((/,  ./(((((((((((((((((((((/*");
    logger.info("*/(((((((((((((((((((((/.  ,/((((((((((((((((((((((((((((((((((((((((((/,  ./((((((((((((((((((((((/");
    logger.info("/((((((((((((((((((((((/.  ,/(((((((((((*,.               .*/((((((((((/,  ./((((((((((((((((((((((/");
    logger.info("/((((((((((((((((((((((/.  ,/((((((*.   .,/((((((((((((((/*.   .*/(((((/,  ./(((((((((((((((((((((((");
    logger.info("(((((((((((((((((((((((/.  ,/((/*   ,/((/*.               .*(((*   ,/((/,  ./(((((((((((((((((((((((");
    logger.info("/((((((((((((((((((((((/.  ,/(((///(/,   .*/(((((((((((((/*.  .,((//(((/,  ./(((((((((((((((((((((((");
    logger.info("*/(((((((((((((((((((((/.  ,/((((((*..*(((/*.           .*/((/*.*((((((/,  ./((((((((((((((((((((((/");
    logger.info("*/(((((((((((((((((((((/.  ,/((((((((((*.  .*/(((((((((/*.  .*(((((((((/,  ./((((((((((((((((((((((/");
    logger.info(" *(((((((((((((((((((((/.  ,/(((((((((((//((((/,     ./((((((((((((((((/,  ./(((((((((((((((((((((/,");
    logger.info(" ,/((((((((((((((((((((/.  ,/((((((((((((((((/.       ./(((((((((((((((/,  ./(((((((((((((((((((((/ ");
    logger.info("  ,/(((((((((((((((((((/.  ,/(((((((((((((((((/,     ,(((((((((((((((((/,  ./((((((((((((((((((((/. ");
    logger.info("  .,(((((((((((((((((((/.  ,/((((((((((((((((((((((((((((((((((((((((((/,  ./(((((((((((((((((((/,  ");
    logger.info("   .,/(((((((((((((((((/.  ,/((((((((((((((((((((((((((((((((((((((((((/,  ./((((((((((((((((((/,   ");
    logger.info("     ,/((((((((((((((((/.  ,/((((((((((((((((((((((((((((((((((((((((((/,  ./(((((((((((((((((*.    ");
    logger.info("      .*(((((((((((((((/.  ,/((((((((((((((((((((((((((((((((((((((((((/,  ./(((((((((((((((/*      ");
    logger.info("        ,/((((((((((((((*                                                  */((((((((((((((*.       ");
    logger.info("          */(((((((((((((((//////////////////////////////////////////////((((((((((((((((/.         ");
    logger.info("            ,/(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((/,           ");
    logger.info("              ./((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((/*.             ");
    logger.info("                 ,/((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((/*.                ");
    logger.info("                    ,//(((((((((((((((((((((((((((((((((((((((((((((((((((((((/*.                   ");
    logger.info("                        *//((((((((((((((((((((((((((((((((((((((((((((((((/,                       ");
    logger.info("                            .*//(((((((((((((((((((((((((((((((((((((//,.                           ");
    logger.info("                                  .,*///(((((((((((((((((((((///*,.                                 ");

    logger.info(" ");
    logger.info(" ");
    logger.info(" ");

    logger.info("=========================================   > SmartHome <   ========================================");
    logger.info(">> by Jan Bellenberg");

    if (Configuration.getCurrentConfiguration().isInDocker())
      logger.info("Docker environment detected");

    this.loadMailSettings();
  }

  /**
   * loading the mail configurations into the system properties
   */
  private void loadMailSettings() {
    JsonNode smtpConfig = Configuration.getCurrentConfiguration().getMailConfig();
    Properties properties = System.getProperties();
    properties.setProperty("mail.smtp.auth", "true");
    properties.setProperty("mail.smtp.starttls.enable", "true");
    properties.setProperty("mail.smtp.host", smtpConfig.get("host").textValue());
    properties.setProperty("mail.smtp.port", String.valueOf(smtpConfig.get("port").asInt()));
  }
}
